<source>
  @type namedpipe
  path /log/php-error.log
  format none
  tag php.error
</source>

<source>
  @type namedpipe
  path /log/fpm-error.log
  format none
  tag php.fpm-error
</source>

<source>
  @type namedpipe
  path /log/slow.log
  format none
  tag php.slowlog
</source>

<source>
  @type namedpipe
  path /log/app-error.json
  time_key timestamp
  format json
  tag php.app-errors
</source>

<source>
  @type namedpipe
  path /log/app-access.json
  time_key timestamp
  format json
  tag php.app-access
</source>

<filter php.*>
  @type record_transformer
  <record>
    hostname "#{Socket.gethostname}"
    event_type ${tag}
    team "#{ENV['TEAM']}"
    application "#{ENV['APPLICATION']}"
  </record>
</filter>

# this must be the latest filter
<filter php.*>
  @type stdout
  include_time_key true
  format json
</filter>

<match **>
  @type null
</match>
